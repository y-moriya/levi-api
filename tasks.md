# 実装フェーズ

## フェーズ1: 基本設定とユーザー認証

1. プロジェクト初期化とHonoセットアップ
2. ユーザー登録・ログイン機能の実装
3. JWT認証の実装

## フェーズ1.1: ブラッシュアップ

1. JWTシークレットを環境変数から読み込むように変更
2. バリデーションの強化
3. テストの実装
4. ロギングの追加

## フェーズ2: ゲーム管理基本機能

1. ゲーム作成・参加・退出機能
2. ゲーム情報取得API
3. ゲーム一覧取得API

## フェーズ2.1: APIテスト実装

1. テスト用サーバーを起動し、HTTPリクエストを送ってレスポンスを検証するAPIテストを実装する
2. ユーザーのAPIテストを実装
3. ゲームのAPIテストを実装

## フェーズ3: ゲームロジック実装

1. ゲーム開始機能
2. フェーズ管理（昼・投票・夜）
3. 役職割り当て
4. ユニットテスト
5. APIテスト

## フェーズ4: ゲームアクション実装

1. 投票アクション
2. 人狼の襲撃アクション
3. 占い師の占いアクション
4. 狩人の護衛アクション

## フェーズ4.1: ゲーム進行のシナリオテスト

1. ゲーム進行のシナリオを定義する
2. APIテストにシナリオテストを追加する

## フェーズ4.2: 包括的シナリオテスト

1. 5人参加者でのゲーム進行テスト
2. 役職固定での詳細なシナリオテスト
3. 村人陣営勝利パターンの検証
4. 人狼陣営勝利パターンの検証

## フェーズ4.3: 不足しているテストの充足 ✅

1. game-logic.tsのテストの追加
2. 足りていないテストを調査し、追加する

## 次のフェーズ

### フェーズ5: チャット機能実装 ✅

1. チャットメッセージのデータ構造設計と実装
2. チャットメッセージ送信・取得APIの実装
3. チャンネル管理（村全体・人狼間）の実装
4. チャット機能のテスト実装

### フェーズ6: API仕様書の更新 ✅

1. OpenAPI仕様書にチャット機能のエンドポイントを追加
   - /chat/{gameId}/messages（POST）メッセージ送信
   - /chat/{gameId}/messages/{channel}（GET）メッセージ取得
2. レスポンス型の定義追加
   - ChatMessage型
   - SendMessageRequest型
   - GetMessagesResponse型
3. エラーレスポンスの定義追加
   - ChatError型
   - CHANNEL_ACCESS_DENIED等のエラーコード
4. APIドキュメントの更新
   - チャット機能の概要説明
   - リクエスト・レスポンスの例
   - 認証要件の説明
   - チャンネルアクセス制御の説明

### フェーズ7: エラーハンドリングの強化 ✅

1. エラー型の整理と統一
   - カスタムエラークラスの設計と実装
   - エラーコードの体系化
   - エラー発生箇所の特定を容易にする情報の追加

2. エラーメッセージの多言語対応
   - メッセージリソースの分離
   - 言語設定の仕組み実装
   - 各エラーメッセージの翻訳追加（日本語・英語）

3. エラーログの強化
   - エラーログフォーマットの改善
   - エラー重要度の分類実装
   - スタックトレース情報の適切な取り扱い

4. クライアントへのエラーレスポンス改善
   - HTTPステータスコードの適切な使用
   - エラーレスポンスの構造化
   - デバッグ情報の制御（開発環境のみ詳細表示）

5. エラーハンドリングのテスト
   - 各種エラーケースのユニットテスト
   - エラー発生時の挙動を確認するAPIテスト
   - エラーログ出力のテスト

### フェーズ8: パフォーマンス最適化

1. データベースクエリの最適化
   - クエリパターンの分析と改善
   - インデックス設計の見直し
   - N+1問題の解消

2. キャッシュ戦略の実装
   - 頻繁にアクセスされるデータのキャッシュ
   - キャッシュの無効化ロジック
   - 分散環境でのキャッシュ整合性確保

3. パフォーマンステストの実装
   - エンドポイント別レスポンス時間計測
   - 同時リクエスト処理のベンチマーク
   - メモリ使用量の監視と最適化

4. 負荷テストの実装
   - 多数のユーザーを想定した負荷シミュレーション
   - スケーラビリティの検証
   - ボトルネック特定と解消
