# 実装フェーズ

## フェーズ1: 基本設定とユーザー認証

1. プロジェクト初期化とHonoセットアップ
2. ユーザー登録・ログイン機能の実装
3. JWT認証の実装

## フェーズ1.1: ブラッシュアップ

1. JWTシークレットを環境変数から読み込むように変更
2. バリデーションの強化
3. テストの実装
4. ロギングの追加

## フェーズ2: ゲーム管理基本機能

1. ゲーム作成・参加・退出機能
2. ゲーム情報取得API
3. ゲーム一覧取得API

## フェーズ2.1: APIテスト実装

1. テスト用サーバーを起動し、HTTPリクエストを送ってレスポンスを検証するAPIテストを実装する
2. ユーザーのAPIテストを実装
3. ゲームのAPIテストを実装

## フェーズ3: ゲームロジック実装

1. ゲーム開始機能
2. フェーズ管理（昼・投票・夜）
3. 役職割り当て
4. ユニットテスト
5. APIテスト

## フェーズ4: ゲームアクション実装

1. 投票アクション
2. 人狼の襲撃アクション
3. 占い師の占いアクション
4. 狩人の護衛アクション

## フェーズ4.1: ゲーム進行のシナリオテスト

1. ゲーム進行のシナリオを定義する
2. APIテストにシナリオテストを追加する

## フェーズ4.2: 包括的シナリオテスト

1. 5人参加者でのゲーム進行テスト
2. 役職固定での詳細なシナリオテスト
3. 村人陣営勝利パターンの検証
4. 人狼陣営勝利パターンの検証

## フェーズ4.3: 不足しているテストの充足 ✅

1. game-logic.tsのテストの追加
2. 足りていないテストを調査し、追加する

## 次のフェーズ

### フェーズ5: チャット機能実装 ✅

1. チャットメッセージのデータ構造設計と実装
2. チャットメッセージ送信・取得APIの実装
3. チャンネル管理（村全体・人狼間）の実装
4. チャット機能のテスト実装

### フェーズ6: API仕様書の更新 ✅

1. OpenAPI仕様書にチャット機能のエンドポイントを追加
   - /chat/{gameId}/messages（POST）メッセージ送信
   - /chat/{gameId}/messages/{channel}（GET）メッセージ取得
2. レスポンス型の定義追加
   - ChatMessage型
   - SendMessageRequest型
   - GetMessagesResponse型
3. エラーレスポンスの定義追加
   - ChatError型
   - CHANNEL_ACCESS_DENIED等のエラーコード
4. APIドキュメントの更新
   - チャット機能の概要説明
   - リクエスト・レスポンスの例
   - 認証要件の説明
   - チャンネルアクセス制御の説明

### フェーズ7: エラーハンドリングの強化 ✅

1. エラー型の整理と統一
   - カスタムエラークラスの設計と実装
   - エラーコードの体系化
   - エラー発生箇所の特定を容易にする情報の追加

2. エラーメッセージの多言語対応
   - メッセージリソースの分離
   - 言語設定の仕組み実装
   - 各エラーメッセージの翻訳追加（日本語・英語）

3. エラーログの強化
   - エラーログフォーマットの改善
   - エラー重要度の分類実装
   - スタックトレース情報の適切な取り扱い

4. クライアントへのエラーレスポンス改善
   - HTTPステータスコードの適切な使用
   - エラーレスポンスの構造化
   - デバッグ情報の制御（開発環境のみ詳細表示）

5. エラーハンドリングのテスト
   - 各種エラーケースのユニットテスト
   - エラー発生時の挙動を確認するAPIテスト
   - エラーログ出力のテスト

### フェーズ8: リファクタリング

1. コード構造の最適化
   - 循環依存関係の排除
   - サービス層の責務の明確化（特にゲームロジックとアクション周り）
   - ユーティリティ関数の整理と共通化
   - 名前空間とインポート構造の見直し

2. パフォーマンス改善
   - ゲーム状態管理の効率化（特に大規模なゲーム進行時）
   - メモリ使用量の最適化
   - 非同期処理の見直しと改善
   - キャッシュ戦略の検討と実装

3. テスト改善
   - テストカバレッジの向上
   - テスト実行速度の改善
   - テストヘルパーの整理と共通化
   - テストデータの分離と管理改善

4. コードの品質向上
   - 一貫したコーディング規約の適用
   - 型定義の強化とTypeScriptの厳格モード対応
   - デッドコードの削除
   - コメントとドキュメントの充実
   - 複雑なロジックの分割と単純化

5. エラー処理の統一
   - 全モジュールでの一貫したエラーハンドリングパターン適用
   - 例外の適切な使用と伝播
   - ユーザーフレンドリーなエラーメッセージの確認と改善

6. セキュリティ強化
   - 入力検証の徹底
   - 認証・認可フローの見直し
   - JWTトークン管理の強化
   - レート制限の実装検討

7. ロギングと監視の強化
   - 構造化ログの導入
   - パフォーマンスメトリクスの収集ポイント設定
   - 重要なビジネスイベントのログ改善
   - デバッグ情報の適切な制御

8. 設定管理の改善
   - 環境変数の一元管理
   - 設定値の検証メカニズム追加
   - デフォルト値の適切な設定
   - 開発/テスト/本番環境の設定分離

9. API設計の一貫性向上
   - RESTful設計原則の徹底
   - レスポンス形式の統一
   - APIバージョニング戦略の検討
   - エンドポイント命名規則の統一

10. 将来の拡張性向上
    - プラグイン機構の検討（新しい役職や機能の追加を容易にするため）
    - イベント駆動型アーキテクチャの要素導入
    - マイクロサービス分割の検討（チャット、認証、ゲームロジックなど）
    - 国際化（i18n）対応の基盤整備

